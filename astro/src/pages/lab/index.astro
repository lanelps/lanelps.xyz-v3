---
import Layout from "@layouts/Layout.astro";
import Draggable from "@components/Draggable.svelte";

import { Image } from "astro:assets";
import MuxVideo from "@components/MuxVideo.svelte";

import type { Experiment } from "../../types";

import PunakaikiPortrait from "@assets/img/punakaiki-portrait.jpg";
// import NaoshimaPortrait from "@assets/img/naoshima-portrait.png";
import FallingSand from "@assets/img/falling-sand.png";

const pageSEO = {
  title: "Lab",
  description: "Lab experiments",
  keywords: [
    "Web Development",
    "Frontend Development",
    "Web Development Portfolio",
    "Frontend Development Portfolio",
  ],
};

const sizes = {
  small: "sm-t:max-w-[20vw]",
  medium: "sm-t:max-w-[25vw]",
  large: "sm-t:max-w-[33.33333vw]",
  xlarge: "sm-t:max-w-[50vw]",
};

const experiments: Experiment[] = [
  {
    title: "Punakaiki",
    type: "image",
    src: PunakaikiPortrait,
    size: "medium",
  },
  {
    title: "Pepeha",
    type: "text",
    text: `Tēnā koe.
    Ko Tititea te maunga.
    Ko Wānaka te Awa.
    Ko Mātaatua tōku waka.
    Ko Ngāpuhi tōku iwi.
    Ko Tauwhara tōku marae.
    Nō Tāmaki ahau.
    Ko Le Prevost-Smith tōku whānau.
    Ko Lane Wirihana tōku ingoa.`,
    size: "large",
  },
  {
    title: "Particles (3D Render)",
    type: "video",
    src: "YCpIXKsvSbfhSKSDkvzx7yjzR00Mop6mgMk84zxnIhiI",
    size: "large",
  },
  {
    title: "Boids",
    type: "video",
    src: "rknZncjXzTUYATo4jM02ncbXCFIWVLmYIoV4eh5rkbQU",
    size: "large",
  },
  // {
  //   title: "Naoshima Island",
  //   type: "image",
  //   src: NaoshimaPortrait,
  //   size: "small",
  // },
  {
    title: "Particles (Threlte + Rapier)",
    type: "video",
    src: "ShfzCBvSnNyNiuIU02KUFtoElj8SUUdzLVK2Jz4AZ3R4",
    link: "particles",
    size: "medium",
  },
  {
    title: "Falling Sand",
    type: "image",
    src: FallingSand,
    link: "falling-sand",
    size: "medium",
  },
  {
    title: "Mirror Scroll (WebGL)",
    type: "video",
    src: "iPnNEPk01ekj5f23fruubpDnhHtTgD2wzSmc00ltne6Vc",
    link: "mirror-scroll",
    size: "xlarge",
  },
];
---

<Layout seo={pageSEO}>
  <div class="bg-dark-grey h-dvh overflow-x-hidden overflow-y-scroll pb-4">
    <ul class="sm-t:flex-row sm-t:flex-wrap flex w-full flex-col">
      {
        experiments.map((experiment, i) => {
          const index = i > 9 ? i + 1 : `0${i + 1}`;

          return (
            <Draggable class="mix-blend-difference" client:load>
              <li>
                <div
                  class:list={[
                    "sm-t:w-auto pointer-events-none w-screen",
                    sizes[experiment.size],
                  ]}
                >
                  {experiment.type === "video" && experiment.src && (
                    <MuxVideo
                      client:load
                      video={{ asset: { playbackId: experiment.src } }}
                      width={960}
                      class="select-none"
                    />
                  )}
                  {experiment.type === "image" &&
                    experiment.src &&
                    typeof experiment.src === "object" && (
                      <Image
                        src={experiment.src}
                        alt={experiment.title}
                        class="object-cover select-none"
                        draggable="false"
                      />
                    )}
                  {experiment.type === "text" && (
                    <p class="text-h1 text-deep-purple-invert font-serif! font-normal! select-none">
                      {experiment.text}
                    </p>
                  )}
                </div>

                <header class="text-caption text-grey select-none">
                  <span>{index}</span>
                  <h2 class="inline">{experiment.title}</h2>
                </header>

                {experiment?.link && (
                  <a
                    href={`/lab/${experiment.link}`}
                    class="link sm-t:opacity-0 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 select-none group-hover:opacity-100"
                  >
                    View
                  </a>
                )}
              </li>
            </Draggable>
          );
        })
      }
    </ul>
  </div>
</Layout>
